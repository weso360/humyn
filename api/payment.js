const stripe = require('stripe')(process.env.STRIPE_SECRET_KEY);\n\nexport default async function handler(req, res) {\n  // Enable CORS\n  res.setHeader('Access-Control-Allow-Credentials', true);\n  res.setHeader('Access-Control-Allow-Origin', '*');\n  res.setHeader('Access-Control-Allow-Methods', 'GET,OPTIONS,PATCH,DELETE,POST,PUT');\n  res.setHeader('Access-Control-Allow-Headers', 'X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version, Authorization');\n\n  if (req.method === 'OPTIONS') {\n    res.status(200).end();\n    return;\n  }\n\n  if (req.method !== 'POST') {\n    return res.status(405).json({ error: 'Method not allowed' });\n  }\n\n  try {\n    const { priceId, userId } = req.body;\n\n    // Create Stripe Checkout Session\n    const session = await stripe.checkout.sessions.create({\n      payment_method_types: ['card'],\n      line_items: [\n        {\n          price_data: {\n            currency: 'usd',\n            product_data: {\n              name: 'Humyn Premium',\n              description: 'Unlimited AI text humanization with advanced features'\n            },\n            unit_amount: 999, // $9.99 in cents\n            recurring: {\n              interval: 'month'\n            }\n          },\n          quantity: 1,\n        },\n      ],\n      mode: 'subscription',\n      success_url: `${process.env.CORS_ORIGIN || 'https://humyn.uk'}/success?session_id={CHECKOUT_SESSION_ID}`,\n      cancel_url: `${process.env.CORS_ORIGIN || 'https://humyn.uk'}/pricing`,\n      metadata: {\n        userId: userId\n      }\n    });\n\n    res.json({ url: session.url });\n\n  } catch (error) {\n    console.error('Stripe error:', error);\n    res.status(500).json({ error: error.message || 'Payment processing failed' });\n  }\n}